<!DOCTYPE html>
<html>
  <head></head>
  <body style="margin:0; padding:0;">
    <div style="display: flex; position:fixed; height: 50; width: 100%;">
      <button id="startButton">Start</button>
      <button id="stopButton">Stop</button>
    </div>
    <canvas id="game" style="position: fixed;" />
  </body>
  <script type="module">
    const cellSize = 40;

    const canvasEl = document.getElementById('game');
    const width = window.innerWidth;
    const height = window.innerHeight - 50;
    canvasEl.setAttribute('width', width);
    canvasEl.setAttribute('height', height);
    const leftPadding = (width % cellSize)/2;
    const topPadding = 50 + (height % cellSize)/2;
    const ctx = canvasEl.getContext('2d'); 

    canvasEl.style.setProperty('left', `${leftPadding}px`);
    canvasEl.style.setProperty('top', `${topPadding}px`);

    const state = Array.from({length: Math.floor(height / cellSize)})
      .map(row => Array.from({length: Math.floor(width / cellSize)}).fill(false));

    function randomizeState(density) {
      forEachCell((i,j) => {
        state[i][j] = Math.random() > density;
      });
    }

    function render() {
      ctx.fillStyle = 'white';
      ctx.clearRect(0,0, width, height);
      forEachCell((col, row) => {
          ctx.strokeStyle = 'black';
          ctx.fillStyle = state[col][row] ? 'black' : 'white';
          
          ctx.fillRect(row * cellSize, col * cellSize, cellSize, cellSize);
          ctx.strokeRect(row * cellSize, col * cellSize, cellSize, cellSize); 
      });
    } 
    
    function forEachCell(cb) {
      for (let col = 0; col < state.length; col++) { 
        for (let row = 0; row < state[col].length; row++) {
          cb(col, row, state[col][row]);
        }
      } 
    }

    let play = false;
    function loop() {
      if (play) {
        stepState();
        render(); 
      }
      setTimeout(loop, 500)
    }

    document.getElementById('startButton').onclick = () => {
      play = true; 
    }
    document.getElementById('stopButton').onclick = () => {
      play = false; 
    }
    addEventListener('mousedown', e => {
     const x = e.clientX;
     const y = e.clientY;
     const col = Math.floor((y - topPadding) / cellSize);
     const row = Math.floor((x - leftPadding) / cellSize);
     if (0 <= col && col < state.length && 0 <= row && row < state[col].length) {
      state[col][row] = ! state[col][row];
      render();
     }
    })

    render();
    loop(); 

    // TODO: implement
    function stepState() {

    }
  </script>
</html>
